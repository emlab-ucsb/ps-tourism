# Get bounding box coordinates for area we want to plot
d2_coords = data.frame(lon = c(10, 10, 40, 40, 10),
lat = c(20, 45, 45, 20, 20)) %>%
st_as_sf(coords = c("lon", "lat"),
crs = 4326) %>%
st_transform(crs = st_crs(prj_moll)) %>%
st_bbox() # xmin, ymin, xmax, ymax
# d_coords = data.frame(lon = c(-10, -10, 40, 40, -10),
#                        lat = c(20, 70, 70, 20, 20)) %>%
#   st_as_sf(coords = c("lon", "lat"),
#            crs = 4326) %>%
#   st_transform(crs = st_crs(prj_moll)) %>%
#   st_bbox() # xmin, ymin, xmax, ymax
# Global map of extrapolated number of dives]
fig_1_d2 <- dive_map_global_pixel +
coord_sf(xlim = c(d2_coords[1], d2_coords[3]),
ylim = c(d2_coords[2], d2_coords[4])) +
theme(panel.border = element_rect(color = "black", fill = NA))
fig_1_d2
# Get bounding box coordinates for area we want to plot
e_coords = data.frame(lon = c(100, 100, 130, 130, 100),
lat = c(-10, 15, 15, -10, -10)) %>%
st_as_sf(coords = c("lon", "lat"),
crs = 4326) %>%
st_transform(crs = st_crs(prj_moll)) %>%
st_bbox() # xmin, ymin, xmax, ymax
# Global map of extrapolated number of dives]
fig_1_e <- dive_map_global_pixel +
coord_sf(xlim = c(e_coords[1], e_coords[3]),
ylim = c(e_coords[2], e_coords[4]))+
theme(panel.border = element_rect(color = "black", fill = NA))
fig_1_e
# Combine subplots
map_row_2 <- cowplot::plot_grid(fig_1_c + theme(legend.position = "none"),
fig_1_e + theme(legend.position = "none"),
nrow = 1,
rel_widths = c(1,1),
labels = c("C", "D"),
label_y = 1.1)
map_row_2
# Combine subplots
map_row_3 <- cowplot::plot_grid(fig_1_d + theme(legend.position = "none"),
fig_1_d2 + theme(legend.position = "none"),
nrow = 1,
rel_widths = c(1,1.05),
labels = c("E", "F"),
label_y = 1.1)
map_row_3
# Now add bigger map
map_column <- cowplot::plot_grid(fig_1_b + theme(legend.position = "none") + labs(title = "") + theme(plot.margin = margin(t = -0.1, unit='cm')),
map_row_2,
map_row_3,
nrow = 3,
rel_heights = c(5,3.5,3.5))
map_column
legend_row <- cowplot::plot_grid(cowplot::get_legend(fig_1_a + theme(legend.margin = margin(t = -0.05, unit='cm'))),
cowplot::get_legend(fig_1_b + theme(legend.margin = margin(t = -0.05, unit='cm'))),
nrow = 1,
rel_widths = c(0.85,1))
legend_row
top_section <- cowplot::plot_grid(fig_1_a + theme(legend.position = "none"),
map_column,
nrow = 1,
rel_widths = c(0.85,1),
labels = c("A", "B"),
label_y = 1)
# Now add left plot
fig_1 <- cowplot::plot_grid(top_section,
legend_row,
nrow = 2,
rel_heights = c(8,1.5))
save_plots(fig_1,
file_name = file.path(emlab_project_dir, "figures", "paper", "fig_1_v2.png"),
width_in = 7.25,
height_in = 8)
save_plots(fig_1,
file_name = file.path("/Users/kat/Github/tourism-mpa/", "figures", "main", "fig_1.png"),
width_in = 7.25,
height_in = 8)
fig_1
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.x = element_text(family = "Roboto", color = "#000000", size = 8))
fig_1_a
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.x = element_text(family = "Roboto", color = "#000000", size = 8))
fig_1_a
top_section <- cowplot::plot_grid(fig_1_a + theme(legend.position = "none"),
map_column,
nrow = 1,
rel_widths = c(0.85,1),
labels = c("A", "B"),
label_y = 1)
legend_row <- cowplot::plot_grid(cowplot::get_legend(fig_1_a + theme(legend.margin = margin(t = -0.05, unit='cm'))),
cowplot::get_legend(fig_1_b + theme(legend.margin = margin(t = -0.05, unit='cm'))),
nrow = 1,
rel_widths = c(0.85,1))
legend_row
# Now add left plot
fig_1 <- cowplot::plot_grid(top_section,
legend_row,
nrow = 2,
rel_heights = c(8,1.5))
save_plots(fig_1,
file_name = file.path(emlab_project_dir, "figures", "paper", "fig_1_v2.png"),
width_in = 7.25,
height_in = 8)
save_plots(fig_1,
file_name = file.path("/Users/kat/Github/tourism-mpa/", "figures", "main", "fig_1.png"),
width_in = 7.25,
height_in = 8)
fig_1
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.x = element_text(family = "Roboto", color = "#000000", size = 6))
fig_1_a
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.x = element_text(family = "Roboto", color = "#000000", size = 5))
fig_1_a
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.y = element_text(family = "Roboto", color = "#000000", size = 5))
fig_1_a
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.x = element_text(family = "Roboto", color = "#000000", size = 6))
fig_1_a
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text.x = element_text(family = "Roboto", color = "#000000", size = 6))
fig_1_a
top_section <- cowplot::plot_grid(fig_1_a + theme(legend.position = "none"),
map_column,
nrow = 1,
rel_widths = c(0.85,1),
labels = c("A", "B"),
label_y = 1)
# Now add bigger map
map_column <- cowplot::plot_grid(fig_1_b + theme(legend.position = "none") + labs(title = "") + theme(plot.margin = margin(t = -0.1, unit='cm')),
map_row_2,
map_row_3,
nrow = 3,
rel_heights = c(5,3.5,3.5))
map_column
legend_row <- cowplot::plot_grid(cowplot::get_legend(fig_1_a + theme(legend.margin = margin(t = -0.05, unit='cm'))),
cowplot::get_legend(fig_1_b + theme(legend.margin = margin(t = -0.05, unit='cm'))),
nrow = 1,
rel_widths = c(0.85,1))
legend_row
top_section <- cowplot::plot_grid(fig_1_a + theme(legend.position = "none"),
map_column,
nrow = 1,
rel_widths = c(0.85,1),
labels = c("A", "B"),
label_y = 1)
# Now add left plot
fig_1 <- cowplot::plot_grid(top_section,
legend_row,
nrow = 2,
rel_heights = c(8,1.5))
save_plots(fig_1,
file_name = file.path(emlab_project_dir, "figures", "paper", "fig_1_v2.png"),
width_in = 7.25,
height_in = 8)
save_plots(fig_1,
file_name = file.path("/Users/kat/Github/tourism-mpa/", "figures", "main", "fig_1.png"),
width_in = 7.25,
height_in = 8)
fig_1
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
legend.text = element_text(size = 8),
axis.text = element_text(family = "Roboto", color = "#000000", size = 6))
fig_1_a
theme_main_text <- function(){
graph_theme <- ggplot2::theme_minimal() +
ggplot2::theme(panel.border = element_blank(),
panel.background = element_rect(fill = "transparent",colour = NA),
plot.background = element_rect(fill = "transparent",colour = NA),
panel.grid.minor=element_blank(),
legend.key.height = unit(3, "mm"),
legend.key.width = unit(20, "mm"),
legend.title.align = 0.5,
text = element_text(family = "Roboto", color = "#000000", size = 10),
legend.text = element_text(family = "Roboto", color = "#000000", size = 10),
legend.title = element_text(family = "Roboto Bold", color = "#000000", size = 10),
plot.title = element_text(family = "Roboto Bold", color = "#000000", size = 12),
plot.subtitle = element_text(family = "Roboto", color = "#000000", size = 12),
axis.title = element_text(family = "Roboto Bold", color = "#000000", size = 10),
axis.text = element_text(family = "Roboto", color = "#000000", size = 6),
strip.text = element_text(family = "Roboto Bold", color = "#000000", size = 10))
}
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal")
fig_1_a
# Panel A
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
axis.text = element_text(family = "Roboto", color = "#000000", size = 8))
fig_1_a
theme_main_text <- function(){
graph_theme <- ggplot2::theme_minimal() +
ggplot2::theme(panel.border = element_blank(),
panel.background = element_rect(fill = "transparent",colour = NA),
plot.background = element_rect(fill = "transparent",colour = NA),
panel.grid.minor=element_blank(),
legend.key.height = unit(3, "mm"),
legend.key.width = unit(20, "mm"),
legend.title.align = 0.5,
text = element_text(family = "Roboto", color = "#000000", size = 10),
legend.text = element_text(family = "Roboto", color = "#000000", size = 10),
legend.title = element_text(family = "Roboto Bold", color = "#000000", size = 10),
plot.title = element_text(family = "Roboto Bold", color = "#000000", size = 12),
plot.subtitle = element_text(family = "Roboto", color = "#000000", size = 12),
axis.title = element_text(family = "Roboto Bold", color = "#000000", size = 10),
axis.text = element_text(family = "Roboto", color = "#000000", size = 10),
strip.text = element_text(family = "Roboto Bold", color = "#000000", size = 10))
}
fig_1_a <- dive_dat_country %>%
dplyr::filter(site_classification == "Marine") %>%
mutate(display_name = str_replace(display_name, "\\*", "")) %>% # remove SIDs asterisks
group_by(protection_level, display_name, eez_ter1_iso3, eez_ter1_name) %>%
summarize(n_dives_extrap = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
group_by(display_name, eez_ter1_iso3, eez_ter1_name) %>%
mutate(total_dives = sum(n_dives_extrap, na.rm = T)) %>%
ungroup() %>%
mutate(percent_dives = (n_dives_extrap/total_dives)*100) %>%
mutate(site_rank = dense_rank(desc(total_dives))) %>%
dplyr::filter(site_rank <= 30) %>%
ggplot()+
aes(x = fct_reorder(display_name, total_dives), y = n_dives_extrap/1e6, fill = protection_level)+
geom_bar(stat = "identity", width = 0.8)+
labs(x = "", y = "Dives (millions per year, extrapolated)")+
scale_y_continuous(expand = c(0,0), limits = c(0,3), labels = comma)+
scale_fill_manual(values = protection_pal[1:5],
guide = guide_legend(reverse = F, title.position = "top", title.hjust = 0.5, nrow = 5, byrow = T, title = ""))+
coord_flip()+
theme_main_text()+
theme(plot.margin = unit(c(0.2,1.5,0.2,0.2), "cm"),
legend.position = "bottom",
legend.direction = "horizontal",
axis.text.y = element_text(family = "Roboto", color = "#000000", size = 8))
fig_1_a
# Now add bigger map
map_column <- cowplot::plot_grid(fig_1_b + theme(legend.position = "none") + labs(title = "") + theme(plot.margin = margin(t = -0.1, unit='cm')),
map_row_2,
map_row_3,
nrow = 3,
rel_heights = c(5,3.5,3.5))
map_column
legend_row <- cowplot::plot_grid(cowplot::get_legend(fig_1_a + theme(legend.margin = margin(t = -0.05, unit='cm'))),
cowplot::get_legend(fig_1_b + theme(legend.margin = margin(t = -0.05, unit='cm'))),
nrow = 1,
rel_widths = c(0.85,1))
legend_row
top_section <- cowplot::plot_grid(fig_1_a + theme(legend.position = "none"),
map_column,
nrow = 1,
rel_widths = c(0.85,1),
labels = c("A", "B"),
label_y = 1)
# Now add left plot
fig_1 <- cowplot::plot_grid(top_section,
legend_row,
nrow = 2,
rel_heights = c(8,1.5))
save_plots(fig_1,
file_name = file.path(emlab_project_dir, "figures", "paper", "fig_1_v2.png"),
width_in = 7.25,
height_in = 8)
save_plots(fig_1,
file_name = file.path("/Users/kat/Github/tourism-mpa/", "figures", "main", "fig_1.png"),
width_in = 7.25,
height_in = 8)
fig_1
